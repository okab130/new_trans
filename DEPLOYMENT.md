# ğŸš€ ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã‚¬ã‚¤ãƒ‰

æœ¬ç•ªç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †ã‚’èª¬æ˜ã—ã¾ã™ã€‚

## ğŸ“‹ ç›®æ¬¡

1. [ãƒ‡ãƒ—ãƒ­ã‚¤å‰ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ](#ãƒ‡ãƒ—ãƒ­ã‚¤å‰ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ)
2. [ç’°å¢ƒæ§‹ç¯‰](#ç’°å¢ƒæ§‹ç¯‰)
3. [Docker ãƒ‡ãƒ—ãƒ­ã‚¤](#dockerãƒ‡ãƒ—ãƒ­ã‚¤)
4. [ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ‡ãƒ—ãƒ­ã‚¤](#ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ‡ãƒ—ãƒ­ã‚¤)
5. [CI/CD ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³](#cicdãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³)
6. [ç›£è¦–ã¨ãƒ­ã‚°](#ç›£è¦–ã¨ãƒ­ã‚°)

---

## ãƒ‡ãƒ—ãƒ­ã‚¤å‰ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

- [ ] ã™ã¹ã¦ã®ç’°å¢ƒå¤‰æ•°ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] JWT_SECRETãŒå¼·å›ºãªãƒ©ãƒ³ãƒ€ãƒ æ–‡å­—åˆ—
- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒå¤‰æ›´ã•ã‚Œã¦ã„ã‚‹
- [ ] APIã‚­ãƒ¼ãŒãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ãªã„
- [ ] HTTPSé€šä¿¡ãŒæœ‰åŠ¹
- [ ] CORSè¨­å®šãŒé©åˆ‡
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

- [ ] æœ¬ç•ªãƒ“ãƒ«ãƒ‰ãŒå®Œäº†ã—ã¦ã„ã‚‹
- [ ] é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ãŒåœ§ç¸®ã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ãŒä½œæˆã•ã‚Œã¦ã„ã‚‹
- [ ] ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹

### ãƒ†ã‚¹ãƒˆ

- [ ] ã™ã¹ã¦ã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆãŒæˆåŠŸ
- [ ] çµ±åˆãƒ†ã‚¹ãƒˆãŒæˆåŠŸ
- [ ] E2Eãƒ†ã‚¹ãƒˆãŒæˆåŠŸï¼ˆå®Ÿè£…äºˆå®šï¼‰
- [ ] è² è·ãƒ†ã‚¹ãƒˆãŒå®Ÿæ–½ã•ã‚Œã¦ã„ã‚‹

### ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [ ] README.mdãŒæ›´æ–°ã•ã‚Œã¦ã„ã‚‹
- [ ] APIä»•æ§˜æ›¸ãŒæœ€æ–°
- [ ] é‹ç”¨ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ãŒæº–å‚™ã•ã‚Œã¦ã„ã‚‹

---

## ç’°å¢ƒæ§‹ç¯‰

### å¿…è¦ãªã‚µãƒ¼ãƒãƒ¼

| ã‚µãƒ¼ãƒãƒ¼ | æ¨å¥¨ã‚¹ãƒšãƒƒã‚¯ |
|---------|------------|
| **ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³** | 2 vCPU, 4GB RAM |
| **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹** | 2 vCPU, 8GB RAM, 100GB SSD |
| **Redis** | 1 vCPU, 2GB RAM |

### å¿…è¦ãªã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢

```bash
# Node.js
node --version  # v20.x

# PostgreSQL
psql --version  # 16.x

# Redis
redis-cli --version  # 7.x

# Nginxï¼ˆãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ï¼‰
nginx -v  # 1.24.x
```

---

## Docker ãƒ‡ãƒ—ãƒ­ã‚¤

### 1. Dockerãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ

#### backend/Dockerfile

```dockerfile
FROM node:20-alpine AS builder

WORKDIR /app

# ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
COPY package*.json ./
RUN npm ci --only=production

# ã‚½ãƒ¼ã‚¹ã‚³ãƒ”ãƒ¼
COPY . .

# Prismaç”Ÿæˆ
RUN npx prisma generate

# ãƒ“ãƒ«ãƒ‰
RUN npm run build

# æœ¬ç•ªã‚¤ãƒ¡ãƒ¼ã‚¸
FROM node:20-alpine

WORKDIR /app

# æœ¬ç•ªä¾å­˜é–¢ä¿‚ã®ã¿ã‚³ãƒ”ãƒ¼
COPY --from=builder /app/node_modules ./node_modules
COPY --from=builder /app/dist ./dist
COPY --from=builder /app/prisma ./prisma
COPY --from=builder /app/package*.json ./

# ãƒãƒ¼ãƒˆå…¬é–‹
EXPOSE 3000

# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
HEALTHCHECK --interval=30s --timeout=3s --start-period=5s --retries=3 \
  CMD node -e "require('http').get('http://localhost:3000/health', (r) => {process.exit(r.statusCode === 200 ? 0 : 1)})"

# èµ·å‹•
CMD ["npm", "start"]
```

#### frontend/Dockerfile

```dockerfile
FROM node:20-alpine AS builder

WORKDIR /app

# ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
COPY package*.json ./
RUN npm ci

# ã‚½ãƒ¼ã‚¹ã‚³ãƒ”ãƒ¼
COPY . .

# ãƒ“ãƒ«ãƒ‰
RUN npm run build

# Nginx ã‚¤ãƒ¡ãƒ¼ã‚¸
FROM nginx:alpine

# ãƒ“ãƒ«ãƒ‰æˆæœç‰©ã‚’ã‚³ãƒ”ãƒ¼
COPY --from=builder /app/dist /usr/share/nginx/html

# Nginxè¨­å®š
COPY nginx.conf /etc/nginx/conf.d/default.conf

EXPOSE 80

CMD ["nginx", "-g", "daemon off;"]
```

#### frontend/nginx.conf

```nginx
server {
    listen 80;
    server_name _;
    root /usr/share/nginx/html;
    index index.html;

    # Gzipåœ§ç¸®
    gzip on;
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;

    # ã‚­ãƒ£ãƒƒã‚·ãƒ¥è¨­å®š
    location ~* \.(jpg|jpeg|png|gif|ico|css|js)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }

    # SPAãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
    location / {
        try_files $uri $uri/ /index.html;
    }

    # APIãƒ—ãƒ­ã‚­ã‚·
    location /api {
        proxy_pass http://backend:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}
```

### 2. Docker Composeè¨­å®š

#### docker-compose.yml

```yaml
version: '3.8'

services:
  # PostgreSQL
  postgres:
    image: postgres:16-alpine
    environment:
      POSTGRES_DB: delivery_management
      POSTGRES_USER: delivery_user
      POSTGRES_PASSWORD: ${DB_PASSWORD}
    volumes:
      - postgres_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U delivery_user"]
      interval: 10s
      timeout: 5s
      retries: 5

  # Redis
  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 10s
      timeout: 3s
      retries: 5

  # Backend
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    environment:
      NODE_ENV: production
      DATABASE_URL: postgresql://delivery_user:${DB_PASSWORD}@postgres:5432/delivery_management
      REDIS_URL: redis://redis:6379
      JWT_SECRET: ${JWT_SECRET}
      PORT: 3000
    ports:
      - "3000:3000"
    depends_on:
      postgres:
        condition: service_healthy
      redis:
        condition: service_healthy
    restart: unless-stopped

  # Frontend
  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    ports:
      - "80:80"
    depends_on:
      - backend
    restart: unless-stopped

volumes:
  postgres_data:
```

### 3. ãƒ‡ãƒ—ãƒ­ã‚¤å®Ÿè¡Œ

```bash
# ç’°å¢ƒå¤‰æ•°è¨­å®š
cp .env.example .env.production
nano .env.production

# Dockerã‚¤ãƒ¡ãƒ¼ã‚¸ãƒ“ãƒ«ãƒ‰
docker-compose build

# èµ·å‹•
docker-compose up -d

# ãƒ­ã‚°ç¢ºèª
docker-compose logs -f

# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
curl http://localhost:3000/health
curl http://localhost/
```

---

## ã‚¯ãƒ©ã‚¦ãƒ‰ãƒ‡ãƒ—ãƒ­ã‚¤

### AWS ãƒ‡ãƒ—ãƒ­ã‚¤

#### 1. ECSï¼ˆElastic Container Serviceï¼‰ä½¿ç”¨

```bash
# ECRã«ãƒ—ãƒƒã‚·ãƒ¥
aws ecr get-login-password --region ap-northeast-1 | docker login --username AWS --password-stdin <account-id>.dkr.ecr.ap-northeast-1.amazonaws.com

# ã‚¿ã‚°ä»˜ã‘
docker tag delivery-backend:latest <account-id>.dkr.ecr.ap-northeast-1.amazonaws.com/delivery-backend:latest

# ãƒ—ãƒƒã‚·ãƒ¥
docker push <account-id>.dkr.ecr.ap-northeast-1.amazonaws.com/delivery-backend:latest
```

#### 2. RDSï¼ˆPostgreSQLï¼‰è¨­å®š

```bash
# RDSã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ
aws rds create-db-instance \
  --db-instance-identifier delivery-db \
  --db-instance-class db.t3.medium \
  --engine postgres \
  --engine-version 16.1 \
  --master-username admin \
  --master-user-password <password> \
  --allocated-storage 100
```

#### 3. ElastiCacheï¼ˆRedisï¼‰è¨­å®š

```bash
# Redisã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ä½œæˆ
aws elasticache create-cache-cluster \
  --cache-cluster-id delivery-redis \
  --cache-node-type cache.t3.micro \
  --engine redis \
  --num-cache-nodes 1
```

### Heroku ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
# Heroku CLI ãƒ­ã‚°ã‚¤ãƒ³
heroku login

# ã‚¢ãƒ—ãƒªä½œæˆ
heroku create delivery-management-app

# PostgreSQL ã‚¢ãƒ‰ã‚ªãƒ³è¿½åŠ 
heroku addons:create heroku-postgresql:standard-0

# Redis ã‚¢ãƒ‰ã‚ªãƒ³è¿½åŠ 
heroku addons:create heroku-redis:premium-0

# ç’°å¢ƒå¤‰æ•°è¨­å®š
heroku config:set NODE_ENV=production
heroku config:set JWT_SECRET=<secret>

# ãƒ‡ãƒ—ãƒ­ã‚¤
git push heroku main

# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
heroku run npx prisma migrate deploy
```

### Vercel ãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼‰

```bash
# Vercel CLI ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
npm i -g vercel

# ãƒ‡ãƒ—ãƒ­ã‚¤
cd frontend
vercel --prod
```

---

## CI/CD ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

### GitHub Actions

#### .github/workflows/deploy.yml

```yaml
name: Deploy to Production

on:
  push:
    branches: [main]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '20'
      
      - name: Install dependencies
        run: |
          cd backend
          npm ci
      
      - name: Run tests
        run: |
          cd backend
          npm test

  build-and-deploy:
    needs: test
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Configure AWS credentials
        uses: aws-actions/configure-aws-credentials@v2
        with:
          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          aws-region: ap-northeast-1
      
      - name: Login to Amazon ECR
        id: login-ecr
        uses: aws-actions/amazon-ecr-login@v1
      
      - name: Build and push Docker image
        env:
          ECR_REGISTRY: ${{ steps.login-ecr.outputs.registry }}
          ECR_REPOSITORY: delivery-backend
          IMAGE_TAG: ${{ github.sha }}
        run: |
          docker build -t $ECR_REGISTRY/$ECR_REPOSITORY:$IMAGE_TAG ./backend
          docker push $ECR_REGISTRY/$ECR_REPOSITORY:$IMAGE_TAG
```

---

## ç›£è¦–ã¨ãƒ­ã‚°

### ãƒ­ã‚°è¨­å®š

#### Winstonï¼ˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼‰

```typescript
// backend/src/utils/logger.ts
import winston from 'winston';

export const logger = winston.createLogger({
  level: process.env.LOG_LEVEL || 'info',
  format: winston.format.combine(
    winston.format.timestamp(),
    winston.format.json()
  ),
  transports: [
    new winston.transports.File({ filename: 'error.log', level: 'error' }),
    new winston.transports.File({ filename: 'combined.log' }),
  ],
});

if (process.env.NODE_ENV !== 'production') {
  logger.add(new winston.transports.Console({
    format: winston.format.simple(),
  }));
}
```

### ç›£è¦–ãƒ„ãƒ¼ãƒ«

#### Prometheus + Grafana

```yaml
# docker-compose.monitoring.yml
version: '3.8'

services:
  prometheus:
    image: prom/prometheus
    volumes:
      - ./prometheus.yml:/etc/prometheus/prometheus.yml
    ports:
      - "9090:9090"

  grafana:
    image: grafana/grafana
    ports:
      - "3001:3000"
    environment:
      - GF_SECURITY_ADMIN_PASSWORD=admin
```

### ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®š

- **ã‚¨ãƒ©ãƒ¼ç‡**: 5%ä»¥ä¸Šã§é€šçŸ¥
- **ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¿ã‚¤ãƒ **: 2ç§’ä»¥ä¸Šã§é€šçŸ¥
- **CPUä½¿ç”¨ç‡**: 80%ä»¥ä¸Šã§é€šçŸ¥
- **ãƒ¡ãƒ¢ãƒªä½¿ç”¨ç‡**: 85%ä»¥ä¸Šã§é€šçŸ¥
- **ãƒ‡ã‚£ã‚¹ã‚¯ä½¿ç”¨ç‡**: 90%ä»¥ä¸Šã§é€šçŸ¥

---

## ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æˆ¦ç•¥

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—

```bash
# æ¯æ—¥è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
0 2 * * * pg_dump -U delivery_user delivery_management > /backup/db_$(date +\%Y\%m\%d).sql

# é€±æ¬¡ãƒ•ãƒ«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
0 3 * * 0 pg_dump -U delivery_user delivery_management | gzip > /backup/weekly_$(date +\%Y\%m\%d).sql.gz
```

### ãƒ•ã‚¡ã‚¤ãƒ«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—

```bash
# ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
aws s3 sync /app/uploads s3://delivery-backups/uploads/ --delete
```

---

## ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ‰‹é †

```bash
# ä»¥å‰ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«æˆ»ã™
docker-compose down
docker tag delivery-backend:previous delivery-backend:latest
docker-compose up -d

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯
npx prisma migrate resolve --rolled-back <migration_name>
```

---

**æœ€çµ‚æ›´æ–°**: 2025-01-20  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0.0
