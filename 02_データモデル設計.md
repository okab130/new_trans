# トラック配送計画・配送実績追跡システム - データモデル設計

## 1. エンティティ関連図（ER図）概要

```
[組織・拠点]
  Organization (組織)
  └─ Branch (拠点)
      ├─ Vehicle (車両)
      ├─ Driver (ドライバー)
      └─ User (ユーザー)

[配送計画]
  DeliveryPlan (配送計画)
  ├─ DeliveryRoute (配送ルート)
  │   ├─ RouteStop (配送先停車地)
  │   └─ RouteOptimization (ルート最適化履歴)
  └─ LoadPlan (積載計画)

[配送依頼・実績]
  Customer (顧客)
  ├─ DeliveryLocation (配送先)
  └─ DeliveryOrder (配送依頼)
      ├─ DeliveryItem (配送品目)
      └─ DeliveryExecution (配送実績)
          ├─ DeliveryEvent (配送イベント)
          ├─ DeliveryProof (配送証跡)
          └─ DeliveryIssue (配送問題)

[位置追跡]
  VehicleTracking (車両追跡)
  └─ TrackingHistory (位置履歴)

[分析・マスタ]
  PerformanceMetrics (実績指標)
  ProductCategory (商品カテゴリ)
  Holiday (休日マスタ)
  TrafficPattern (交通パターン)
```

## 2. 詳細データモデル定義

### 2.1 組織・リソース管理

#### Organization (組織)
| 項目名 | 物理名 | 型 | 制約 | 説明 |
|--------|--------|-----|------|------|
| 組織ID | organization_id | VARCHAR(20) | PK | 組織識別子 |
| 組織名 | organization_name | VARCHAR(100) | NOT NULL | 組織名称 |
| 組織種別 | organization_type | VARCHAR(20) | NOT NULL | 本社/支社/営業所 |
| 親組織ID | parent_organization_id | VARCHAR(20) | FK | 上位組織 |
| 有効フラグ | is_active | BOOLEAN | NOT NULL, DEFAULT TRUE | 有効/無効 |
| 作成日時 | created_at | TIMESTAMP | NOT NULL | 作成日時 |
| 更新日時 | updated_at | TIMESTAMP | NOT NULL | 更新日時 |

#### Branch (拠点)
| 項目名 | 物理名 | 型 | 制約 | 説明 |
|--------|--------|-----|------|------|
| 拠点ID | branch_id | VARCHAR(20) | PK | 拠点識別子 |
| 組織ID | organization_id | VARCHAR(20) | FK, NOT NULL | 所属組織 |
| 拠点名 | branch_name | VARCHAR(100) | NOT NULL | 拠点名称 |
| 拠点コード | branch_code | VARCHAR(10) | UNIQUE, NOT NULL | 拠点コード |
| 郵便番号 | postal_code | VARCHAR(10) | | 郵便番号 |
| 住所 | address | VARCHAR(200) | NOT NULL | 住所 |
| 緯度 | latitude | DECIMAL(10,7) | | 緯度 |
| 経度 | longitude | DECIMAL(10,7) | | 経度 |
| 電話番号 | phone_number | VARCHAR(20) | | 電話番号 |
| 営業開始時刻 | business_start_time | TIME | NOT NULL | 営業開始時刻 |
| 営業終了時刻 | business_end_time | TIME | NOT NULL | 営業終了時刻 |
| 有効フラグ | is_active | BOOLEAN | NOT NULL, DEFAULT TRUE | 有効/無効 |
| 作成日時 | created_at | TIMESTAMP | NOT NULL | 作成日時 |
| 更新日時 | updated_at | TIMESTAMP | NOT NULL | 更新日時 |

#### Vehicle (車両)
| 項目名 | 物理名 | 型 | 制約 | 説明 |
|--------|--------|-----|------|------|
| 車両ID | vehicle_id | VARCHAR(20) | PK | 車両識別子 |
| 拠点ID | branch_id | VARCHAR(20) | FK, NOT NULL | 所属拠点 |
| 車両番号 | vehicle_number | VARCHAR(20) | UNIQUE, NOT NULL | 車両ナンバー |
| 車両名 | vehicle_name | VARCHAR(50) | | 車両名称 |
| 車両種別 | vehicle_type | VARCHAR(20) | NOT NULL | 小型/中型/大型 |
| 最大積載量 | max_load_weight | DECIMAL(8,2) | NOT NULL | 最大積載量(kg) |
| 最大積載容積 | max_load_volume | DECIMAL(8,2) | NOT NULL | 最大積載容積(m3) |
| 特殊装備 | special_equipment | VARCHAR(50) | | 冷蔵/冷凍/パワーゲート等 |
| 燃料種別 | fuel_type | VARCHAR(20) | NOT NULL | ガソリン/軽油/電気 |
| 車検有効期限 | vehicle_inspection_date | DATE | | 車検期限 |
| 保険有効期限 | insurance_expiry_date | DATE | | 保険期限 |
| GPS端末ID | gps_device_id | VARCHAR(30) | | GPS端末識別子 |
| 稼働状態 | operational_status | VARCHAR(20) | NOT NULL | 稼働中/整備中/故障 |
| 有効フラグ | is_active | BOOLEAN | NOT NULL, DEFAULT TRUE | 有効/無効 |
| 作成日時 | created_at | TIMESTAMP | NOT NULL | 作成日時 |
| 更新日時 | updated_at | TIMESTAMP | NOT NULL | 更新日時 |

#### Driver (ドライバー)
| 項目名 | 物理名 | 型 | 制約 | 説明 |
|--------|--------|-----|------|------|
| ドライバーID | driver_id | VARCHAR(20) | PK | ドライバー識別子 |
| 拠点ID | branch_id | VARCHAR(20) | FK, NOT NULL | 所属拠点 |
| ドライバーコード | driver_code | VARCHAR(10) | UNIQUE, NOT NULL | ドライバーコード |
| 氏名 | driver_name | VARCHAR(50) | NOT NULL | 氏名 |
| 氏名カナ | driver_name_kana | VARCHAR(50) | | 氏名カナ |
| 電話番号 | phone_number | VARCHAR(20) | NOT NULL | 電話番号 |
| メールアドレス | email | VARCHAR(100) | | メールアドレス |
| 免許種別 | license_type | VARCHAR(20) | NOT NULL | 普通/準中型/中型/大型 |
| 免許有効期限 | license_expiry_date | DATE | NOT NULL | 免許期限 |
| 雇用形態 | employment_type | VARCHAR(20) | NOT NULL | 正社員/契約/パート |
| 入社日 | hire_date | DATE | | 入社日 |
| スキルタグ | skill_tags | JSON | | スキル情報(JSON配列) |
| 勤務パターン | work_pattern | VARCHAR(20) | NOT NULL | フルタイム/午前/午後 |
| 稼働状態 | operational_status | VARCHAR(20) | NOT NULL | 稼働中/休暇/休職 |
| 有効フラグ | is_active | BOOLEAN | NOT NULL, DEFAULT TRUE | 有効/無効 |
| 作成日時 | created_at | TIMESTAMP | NOT NULL | 作成日時 |
| 更新日時 | updated_at | TIMESTAMP | NOT NULL | 更新日時 |

#### User (ユーザー)
| 項目名 | 物理名 | 型 | 制約 | 説明 |
|--------|--------|-----|------|------|
| ユーザーID | user_id | VARCHAR(20) | PK | ユーザー識別子 |
| 拠点ID | branch_id | VARCHAR(20) | FK | 所属拠点 |
| ドライバーID | driver_id | VARCHAR(20) | FK | 関連ドライバー |
| ログインID | login_id | VARCHAR(50) | UNIQUE, NOT NULL | ログインID |
| パスワードハッシュ | password_hash | VARCHAR(255) | NOT NULL | パスワード(ハッシュ化) |
| 氏名 | user_name | VARCHAR(50) | NOT NULL | 氏名 |
| メールアドレス | email | VARCHAR(100) | NOT NULL | メールアドレス |
| ロール | role | VARCHAR(20) | NOT NULL | ADMIN/DISPATCHER/DRIVER |
| 最終ログイン日時 | last_login_at | TIMESTAMP | | 最終ログイン |
| 有効フラグ | is_active | BOOLEAN | NOT NULL, DEFAULT TRUE | 有効/無効 |
| 作成日時 | created_at | TIMESTAMP | NOT NULL | 作成日時 |
| 更新日時 | updated_at | TIMESTAMP | NOT NULL | 更新日時 |

### 2.2 顧客・配送先管理

#### Customer (顧客)
| 項目名 | 物理名 | 型 | 制約 | 説明 |
|--------|--------|-----|------|------|
| 顧客ID | customer_id | VARCHAR(20) | PK | 顧客識別子 |
| 顧客コード | customer_code | VARCHAR(20) | UNIQUE, NOT NULL | 顧客コード |
| 顧客名 | customer_name | VARCHAR(100) | NOT NULL | 顧客名称 |
| 顧客名カナ | customer_name_kana | VARCHAR(100) | | 顧客名カナ |
| 顧客種別 | customer_type | VARCHAR(20) | NOT NULL | 法人/個人 |
| 電話番号 | phone_number | VARCHAR(20) | | 電話番号 |
| メールアドレス | email | VARCHAR(100) | | メールアドレス |
| 請求先住所 | billing_address | VARCHAR(200) | | 請求先住所 |
| 優先度 | priority_level | INTEGER | NOT NULL, DEFAULT 3 | 1(高)〜5(低) |
| 契約開始日 | contract_start_date | DATE | | 契約開始日 |
| 契約終了日 | contract_end_date | DATE | | 契約終了日 |
| 備考 | remarks | TEXT | | 備考 |
| 有効フラグ | is_active | BOOLEAN | NOT NULL, DEFAULT TRUE | 有効/無効 |
| 作成日時 | created_at | TIMESTAMP | NOT NULL | 作成日時 |
| 更新日時 | updated_at | TIMESTAMP | NOT NULL | 更新日時 |

#### DeliveryLocation (配送先)
| 項目名 | 物理名 | 型 | 制約 | 説明 |
|--------|--------|-----|------|------|
| 配送先ID | delivery_location_id | VARCHAR(20) | PK | 配送先識別子 |
| 顧客ID | customer_id | VARCHAR(20) | FK, NOT NULL | 顧客 |
| 配送先コード | location_code | VARCHAR(20) | UNIQUE, NOT NULL | 配送先コード |
| 配送先名 | location_name | VARCHAR(100) | NOT NULL | 配送先名称 |
| 郵便番号 | postal_code | VARCHAR(10) | | 郵便番号 |
| 住所 | address | VARCHAR(200) | NOT NULL | 住所 |
| 建物名 | building_name | VARCHAR(100) | | 建物名・部屋番号 |
| 緯度 | latitude | DECIMAL(10,7) | | 緯度 |
| 経度 | longitude | DECIMAL(10,7) | | 経度 |
| 電話番号 | phone_number | VARCHAR(20) | NOT NULL | 電話番号 |
| 受取担当者名 | contact_person | VARCHAR(50) | | 受取担当者 |
| 配送時間帯指定 | preferred_time_slot | VARCHAR(20) | | 午前/午後/時間指定 |
| 配送注意事項 | delivery_notes | TEXT | | 配送注意事項 |
| アクセス情報 | access_info | TEXT | | 駐車場・入口情報 |
| 有効フラグ | is_active | BOOLEAN | NOT NULL, DEFAULT TRUE | 有効/無効 |
| 作成日時 | created_at | TIMESTAMP | NOT NULL | 作成日時 |
| 更新日時 | updated_at | TIMESTAMP | NOT NULL | 更新日時 |

### 2.3 配送依頼・品目管理

#### DeliveryOrder (配送依頼)
| 項目名 | 物理名 | 型 | 制約 | 説明 |
|--------|--------|-----|------|------|
| 配送依頼ID | delivery_order_id | VARCHAR(20) | PK | 配送依頼識別子 |
| 配送依頼番号 | order_number | VARCHAR(30) | UNIQUE, NOT NULL | 配送依頼番号 |
| 顧客ID | customer_id | VARCHAR(20) | FK, NOT NULL | 顧客 |
| 配送先ID | delivery_location_id | VARCHAR(20) | FK, NOT NULL | 配送先 |
| 拠点ID | branch_id | VARCHAR(20) | FK, NOT NULL | 出荷拠点 |
| 依頼日 | order_date | DATE | NOT NULL | 依頼日 |
| 希望配送日 | requested_delivery_date | DATE | NOT NULL | 希望配送日 |
| 配送時間帯 | delivery_time_slot | VARCHAR(20) | | 午前/午後/時間指定 |
| 指定時刻FROM | specified_time_from | TIME | | 指定時刻(開始) |
| 指定時刻TO | specified_time_to | TIME | | 指定時刻(終了) |
| 優先度 | priority | VARCHAR(20) | NOT NULL, DEFAULT 'NORMAL' | HIGH/NORMAL/LOW |
| 総重量 | total_weight | DECIMAL(8,2) | | 総重量(kg) |
| 総容積 | total_volume | DECIMAL(8,2) | | 総容積(m3) |
| 総個数 | total_quantity | INTEGER | | 総個数 |
| 特記事項 | special_instructions | TEXT | | 特記事項 |
| 配送種別 | delivery_type | VARCHAR(20) | NOT NULL | 通常/チャーター/緊急 |
| 温度帯 | temperature_zone | VARCHAR(20) | | 常温/冷蔵/冷凍 |
| ステータス | status | VARCHAR(20) | NOT NULL | PENDING/PLANNED/ASSIGNED/COMPLETED/CANCELLED |
| キャンセル理由 | cancellation_reason | VARCHAR(200) | | キャンセル理由 |
| 作成者ID | created_by | VARCHAR(20) | FK, NOT NULL | 作成者 |
| 作成日時 | created_at | TIMESTAMP | NOT NULL | 作成日時 |
| 更新日時 | updated_at | TIMESTAMP | NOT NULL | 更新日時 |

#### DeliveryItem (配送品目)
| 項目名 | 物理名 | 型 | 制約 | 説明 |
|--------|--------|-----|------|------|
| 配送品目ID | delivery_item_id | VARCHAR(20) | PK | 配送品目識別子 |
| 配送依頼ID | delivery_order_id | VARCHAR(20) | FK, NOT NULL | 配送依頼 |
| 明細番号 | line_number | INTEGER | NOT NULL | 明細番号 |
| 品目コード | item_code | VARCHAR(30) | | 品目コード |
| 品目名 | item_name | VARCHAR(100) | NOT NULL | 品目名 |
| カテゴリID | category_id | VARCHAR(20) | FK | カテゴリ |
| 数量 | quantity | INTEGER | NOT NULL | 数量 |
| 単位 | unit | VARCHAR(10) | NOT NULL | 個/箱/パレット等 |
| 重量 | weight | DECIMAL(8,2) | | 重量(kg) |
| 容積 | volume | DECIMAL(8,2) | | 容積(m3) |
| 備考 | remarks | VARCHAR(200) | | 備考 |
| 作成日時 | created_at | TIMESTAMP | NOT NULL | 作成日時 |
| 更新日時 | updated_at | TIMESTAMP | NOT NULL | 更新日時 |

### 2.4 配送計画管理

#### DeliveryPlan (配送計画)
| 項目名 | 物理名 | 型 | 制約 | 説明 |
|--------|--------|-----|------|------|
| 配送計画ID | delivery_plan_id | VARCHAR(20) | PK | 配送計画識別子 |
| 拠点ID | branch_id | VARCHAR(20) | FK, NOT NULL | 拠点 |
| 計画日 | plan_date | DATE | NOT NULL | 計画日 |
| 計画名 | plan_name | VARCHAR(100) | | 計画名 |
| ステータス | status | VARCHAR(20) | NOT NULL | DRAFT/CONFIRMED/IN_PROGRESS/COMPLETED |
| 確定日時 | confirmed_at | TIMESTAMP | | 確定日時 |
| 確定者ID | confirmed_by | VARCHAR(20) | FK | 確定者 |
| 作成者ID | created_by | VARCHAR(20) | FK, NOT NULL | 作成者 |
| 作成日時 | created_at | TIMESTAMP | NOT NULL | 作成日時 |
| 更新日時 | updated_at | TIMESTAMP | NOT NULL | 更新日時 |

#### DeliveryRoute (配送ルート)
| 項目名 | 物理名 | 型 | 制約 | 説明 |
|--------|--------|-----|------|------|
| 配送ルートID | delivery_route_id | VARCHAR(20) | PK | 配送ルート識別子 |
| 配送計画ID | delivery_plan_id | VARCHAR(20) | FK, NOT NULL | 配送計画 |
| 車両ID | vehicle_id | VARCHAR(20) | FK, NOT NULL | 車両 |
| ドライバーID | driver_id | VARCHAR(20) | FK, NOT NULL | ドライバー |
| ルート番号 | route_number | VARCHAR(20) | NOT NULL | ルート番号 |
| 出発予定時刻 | scheduled_departure_time | TIMESTAMP | NOT NULL | 出発予定時刻 |
| 帰庫予定時刻 | scheduled_return_time | TIMESTAMP | NOT NULL | 帰庫予定時刻 |
| 総配送先数 | total_stops | INTEGER | NOT NULL | 総配送先数 |
| 総距離 | total_distance | DECIMAL(8,2) | | 総距離(km) |
| 総所要時間 | total_duration | INTEGER | | 総所要時間(分) |
| 積載重量 | loaded_weight | DECIMAL(8,2) | | 積載重量(kg) |
| 積載容積 | loaded_volume | DECIMAL(8,2) | | 積載容積(m3) |
| ステータス | status | VARCHAR(20) | NOT NULL | PENDING/IN_PROGRESS/COMPLETED/CANCELLED |
| 実出発時刻 | actual_departure_time | TIMESTAMP | | 実出発時刻 |
| 実帰庫時刻 | actual_return_time | TIMESTAMP | | 実帰庫時刻 |
| 作成日時 | created_at | TIMESTAMP | NOT NULL | 作成日時 |
| 更新日時 | updated_at | TIMESTAMP | NOT NULL | 更新日時 |

#### RouteStop (配送先停車地)
| 項目名 | 物理名 | 型 | 制約 | 説明 |
|--------|--------|-----|------|------|
| 停車地ID | route_stop_id | VARCHAR(20) | PK | 停車地識別子 |
| 配送ルートID | delivery_route_id | VARCHAR(20) | FK, NOT NULL | 配送ルート |
| 配送依頼ID | delivery_order_id | VARCHAR(20) | FK, NOT NULL | 配送依頼 |
| 停車順序 | stop_sequence | INTEGER | NOT NULL | 停車順序 |
| 到着予定時刻 | scheduled_arrival_time | TIMESTAMP | NOT NULL | 到着予定時刻 |
| 出発予定時刻 | scheduled_departure_time | TIMESTAMP | NOT NULL | 出発予定時刻 |
| 作業予定時間 | estimated_service_time | INTEGER | NOT NULL | 作業予定時間(分) |
| 次停車地距離 | distance_to_next | DECIMAL(8,2) | | 次停車地距離(km) |
| 次停車地所要時間 | duration_to_next | INTEGER | | 次停車地所要時間(分) |
| ステータス | status | VARCHAR(20) | NOT NULL | PENDING/ARRIVED/IN_SERVICE/COMPLETED/FAILED |
| 実到着時刻 | actual_arrival_time | TIMESTAMP | | 実到着時刻 |
| 実出発時刻 | actual_departure_time | TIMESTAMP | | 実出発時刻 |
| 作成日時 | created_at | TIMESTAMP | NOT NULL | 作成日時 |
| 更新日時 | updated_at | TIMESTAMP | NOT NULL | 更新日時 |

#### LoadPlan (積載計画)
| 項目名 | 物理名 | 型 | 制約 | 説明 |
|--------|--------|-----|------|------|
| 積載計画ID | load_plan_id | VARCHAR(20) | PK | 積載計画識別子 |
| 配送ルートID | delivery_route_id | VARCHAR(20) | FK, NOT NULL | 配送ルート |
| 配送依頼ID | delivery_order_id | VARCHAR(20) | FK, NOT NULL | 配送依頼 |
| 積載順序 | load_sequence | INTEGER | NOT NULL | 積載順序 |
| 積載位置 | load_position | VARCHAR(50) | | 積載位置(前/中/後) |
| 重量 | weight | DECIMAL(8,2) | NOT NULL | 重量(kg) |
| 容積 | volume | DECIMAL(8,2) | NOT NULL | 容積(m3) |
| 作成日時 | created_at | TIMESTAMP | NOT NULL | 作成日時 |
| 更新日時 | updated_at | TIMESTAMP | NOT NULL | 更新日時 |

#### RouteOptimization (ルート最適化履歴)
| 項目名 | 物理名 | 型 | 制約 | 説明 |
|--------|--------|-----|------|------|
| 最適化ID | optimization_id | VARCHAR(20) | PK | 最適化識別子 |
| 配送ルートID | delivery_route_id | VARCHAR(20) | FK, NOT NULL | 配送ルート |
| 最適化種別 | optimization_type | VARCHAR(20) | NOT NULL | 距離/時間/燃費 |
| 最適化前距離 | before_distance | DECIMAL(8,2) | | 最適化前距離(km) |
| 最適化後距離 | after_distance | DECIMAL(8,2) | | 最適化後距離(km) |
| 改善率 | improvement_rate | DECIMAL(5,2) | | 改善率(%) |
| 実行者ID | executed_by | VARCHAR(20) | FK | 実行者 |
| 実行日時 | executed_at | TIMESTAMP | NOT NULL | 実行日時 |

### 2.5 配送実績管理

#### DeliveryExecution (配送実績)
| 項目名 | 物理名 | 型 | 制約 | 説明 |
|--------|--------|-----|------|------|
| 配送実績ID | delivery_execution_id | VARCHAR(20) | PK | 配送実績識別子 |
| 配送依頼ID | delivery_order_id | VARCHAR(20) | FK, NOT NULL | 配送依頼 |
| 停車地ID | route_stop_id | VARCHAR(20) | FK | 停車地 |
| 配送ルートID | delivery_route_id | VARCHAR(20) | FK, NOT NULL | 配送ルート |
| 配送日 | delivery_date | DATE | NOT NULL | 配送日 |
| 配送結果 | delivery_result | VARCHAR(20) | NOT NULL | SUCCESS/PARTIAL/FAILED/RESCHEDULED |
| 到着時刻 | arrival_time | TIMESTAMP | | 到着時刻 |
| 作業開始時刻 | service_start_time | TIMESTAMP | | 作業開始時刻 |
| 作業終了時刻 | service_end_time | TIMESTAMP | | 作業終了時刻 |
| 出発時刻 | departure_time | TIMESTAMP | | 出発時刻 |
| 受領者名 | receiver_name | VARCHAR(50) | | 受領者名 |
| 受領者関係 | receiver_relationship | VARCHAR(20) | | 本人/家族/同僚等 |
| 配送個数 | delivered_quantity | INTEGER | | 配送個数 |
| 未配送個数 | undelivered_quantity | INTEGER | | 未配送個数 |
| 未配送理由 | undelivered_reason | VARCHAR(200) | | 未配送理由 |
| 備考 | remarks | TEXT | | 備考 |
| 記録者ID | recorded_by | VARCHAR(20) | FK, NOT NULL | 記録者(ドライバー) |
| 記録日時 | recorded_at | TIMESTAMP | NOT NULL | 記録日時 |
| 作成日時 | created_at | TIMESTAMP | NOT NULL | 作成日時 |
| 更新日時 | updated_at | TIMESTAMP | NOT NULL | 更新日時 |

#### DeliveryEvent (配送イベント)
| 項目名 | 物理名 | 型 | 制約 | 説明 |
|--------|--------|-----|------|------|
| イベントID | event_id | VARCHAR(20) | PK | イベント識別子 |
| 配送実績ID | delivery_execution_id | VARCHAR(20) | FK | 配送実績 |
| 配送ルートID | delivery_route_id | VARCHAR(20) | FK, NOT NULL | 配送ルート |
| イベント種別 | event_type | VARCHAR(30) | NOT NULL | DEPARTED/ARRIVED/LOADING_START/LOADING_END/UNLOADING_START/UNLOADING_END/BREAK_START/BREAK_END/RETURNED |
| イベント日時 | event_timestamp | TIMESTAMP | NOT NULL | イベント発生日時 |
| 緯度 | latitude | DECIMAL(10,7) | | 緯度 |
| 経度 | longitude | DECIMAL(10,7) | | 経度 |
| 備考 | remarks | VARCHAR(200) | | 備考 |
| 記録者ID | recorded_by | VARCHAR(20) | FK | 記録者 |
| 作成日時 | created_at | TIMESTAMP | NOT NULL | 作成日時 |

#### DeliveryProof (配送証跡)
| 項目名 | 物理名 | 型 | 制約 | 説明 |
|--------|--------|-----|------|------|
| 証跡ID | proof_id | VARCHAR(20) | PK | 証跡識別子 |
| 配送実績ID | delivery_execution_id | VARCHAR(20) | FK, NOT NULL | 配送実績 |
| 証跡種別 | proof_type | VARCHAR(20) | NOT NULL | SIGNATURE/PHOTO/NOTE |
| 署名画像URL | signature_image_url | VARCHAR(500) | | 署名画像URL |
| 写真URL | photo_url | VARCHAR(500) | | 写真URL |
| 撮影日時 | captured_at | TIMESTAMP | | 撮影日時 |
| 備考 | remarks | TEXT | | 備考 |
| アップロード者ID | uploaded_by | VARCHAR(20) | FK, NOT NULL | アップロード者 |
| 作成日時 | created_at | TIMESTAMP | NOT NULL | 作成日時 |

#### DeliveryIssue (配送問題)
| 項目名 | 物理名 | 型 | 制約 | 説明 |
|--------|--------|-----|------|------|
| 問題ID | issue_id | VARCHAR(20) | PK | 問題識別子 |
| 配送実績ID | delivery_execution_id | VARCHAR(20) | FK | 配送実績 |
| 配送ルートID | delivery_route_id | VARCHAR(20) | FK | 配送ルート |
| 問題種別 | issue_type | VARCHAR(30) | NOT NULL | ABSENT/REFUSED/ADDRESS_UNKNOWN/DAMAGED/VEHICLE_TROUBLE/ACCIDENT/TRAFFIC_JAM/OTHER |
| 問題発生日時 | occurred_at | TIMESTAMP | NOT NULL | 発生日時 |
| 問題内容 | issue_description | TEXT | NOT NULL | 問題内容 |
| 対応内容 | resolution_description | TEXT | | 対応内容 |
| ステータス | status | VARCHAR(20) | NOT NULL | OPEN/IN_PROGRESS/RESOLVED/CLOSED |
| 重要度 | severity | VARCHAR(20) | NOT NULL | LOW/MEDIUM/HIGH/CRITICAL |
| 報告者ID | reported_by | VARCHAR(20) | FK, NOT NULL | 報告者 |
| 対応者ID | assigned_to | VARCHAR(20) | FK | 対応者 |
| 解決日時 | resolved_at | TIMESTAMP | | 解決日時 |
| 作成日時 | created_at | TIMESTAMP | NOT NULL | 作成日時 |
| 更新日時 | updated_at | TIMESTAMP | NOT NULL | 更新日時 |

### 2.6 位置追跡管理

#### VehicleTracking (車両追跡)
| 項目名 | 物理名 | 型 | 制約 | 説明 |
|--------|--------|-----|------|------|
| 追跡ID | tracking_id | VARCHAR(20) | PK | 追跡識別子 |
| 車両ID | vehicle_id | VARCHAR(20) | FK, NOT NULL | 車両 |
| 配送ルートID | delivery_route_id | VARCHAR(20) | FK | 配送ルート |
| 緯度 | latitude | DECIMAL(10,7) | NOT NULL | 緯度 |
| 経度 | longitude | DECIMAL(10,7) | NOT NULL | 経度 |
| 速度 | speed | DECIMAL(5,2) | | 速度(km/h) |
| 方位 | heading | DECIMAL(5,2) | | 方位(度) |
| 測位精度 | accuracy | DECIMAL(8,2) | | 測位精度(m) |
| 車両状態 | vehicle_status | VARCHAR(20) | NOT NULL | MOVING/STOPPED/IDLE |
| バッテリー残量 | battery_level | INTEGER | | バッテリー残量(%) |
| 記録日時 | recorded_at | TIMESTAMP | NOT NULL | 記録日時 |
| 作成日時 | created_at | TIMESTAMP | NOT NULL | 作成日時 |

#### TrackingHistory (位置履歴)
| 項目名 | 物理名 | 型 | 制約 | 説明 |
|--------|--------|-----|------|------|
| 履歴ID | history_id | VARCHAR(20) | PK | 履歴識別子 |
| 車両ID | vehicle_id | VARCHAR(20) | FK, NOT NULL | 車両 |
| 配送ルートID | delivery_route_id | VARCHAR(20) | FK | 配送ルート |
| 緯度 | latitude | DECIMAL(10,7) | NOT NULL | 緯度 |
| 経度 | longitude | DECIMAL(10,7) | NOT NULL | 経度 |
| 速度 | speed | DECIMAL(5,2) | | 速度(km/h) |
| 記録日時 | recorded_at | TIMESTAMP | NOT NULL | 記録日時 |
| 作成日時 | created_at | TIMESTAMP | NOT NULL | 作成日時 |

### 2.7 分析・マスタデータ

#### PerformanceMetrics (実績指標)
| 項目名 | 物理名 | 型 | 制約 | 説明 |
|--------|--------|-----|------|------|
| 指標ID | metrics_id | VARCHAR(20) | PK | 指標識別子 |
| 集計日 | metrics_date | DATE | NOT NULL | 集計日 |
| 拠点ID | branch_id | VARCHAR(20) | FK | 拠点 |
| 配送ルートID | delivery_route_id | VARCHAR(20) | FK | 配送ルート |
| ドライバーID | driver_id | VARCHAR(20) | FK | ドライバー |
| 総配送件数 | total_deliveries | INTEGER | NOT NULL | 総配送件数 |
| 成功配送件数 | successful_deliveries | INTEGER | NOT NULL | 成功配送件数 |
| 失敗配送件数 | failed_deliveries | INTEGER | NOT NULL | 失敗配送件数 |
| 定時配送件数 | on_time_deliveries | INTEGER | NOT NULL | 定時配送件数 |
| 総走行距離 | total_distance | DECIMAL(10,2) | | 総走行距離(km) |
| 総稼働時間 | total_working_hours | DECIMAL(8,2) | | 総稼働時間(時間) |
| 平均配送時間 | avg_delivery_time | DECIMAL(8,2) | | 平均配送時間(分) |
| 燃料消費量 | fuel_consumption | DECIMAL(8,2) | | 燃料消費量(L) |
| 定時配送率 | on_time_rate | DECIMAL(5,2) | | 定時配送率(%) |
| 配送効率 | delivery_efficiency | DECIMAL(5,2) | | 配送効率(件/km) |
| 作成日時 | created_at | TIMESTAMP | NOT NULL | 作成日時 |

#### ProductCategory (商品カテゴリ)
| 項目名 | 物理名 | 型 | 制約 | 説明 |
|--------|--------|-----|------|------|
| カテゴリID | category_id | VARCHAR(20) | PK | カテゴリ識別子 |
| カテゴリコード | category_code | VARCHAR(20) | UNIQUE, NOT NULL | カテゴリコード |
| カテゴリ名 | category_name | VARCHAR(50) | NOT NULL | カテゴリ名 |
| 親カテゴリID | parent_category_id | VARCHAR(20) | FK | 親カテゴリ |
| 温度帯 | temperature_zone | VARCHAR(20) | | 常温/冷蔵/冷凍 |
| 取扱注意フラグ | fragile_flag | BOOLEAN | DEFAULT FALSE | 取扱注意 |
| 有効フラグ | is_active | BOOLEAN | NOT NULL, DEFAULT TRUE | 有効/無効 |
| 作成日時 | created_at | TIMESTAMP | NOT NULL | 作成日時 |
| 更新日時 | updated_at | TIMESTAMP | NOT NULL | 更新日時 |

#### Holiday (休日マスタ)
| 項目名 | 物理名 | 型 | 制約 | 説明 |
|--------|--------|-----|------|------|
| 休日ID | holiday_id | VARCHAR(20) | PK | 休日識別子 |
| 休日日付 | holiday_date | DATE | UNIQUE, NOT NULL | 休日日付 |
| 休日名 | holiday_name | VARCHAR(50) | NOT NULL | 休日名 |
| 休日種別 | holiday_type | VARCHAR(20) | NOT NULL | 祝日/特別休日 |
| 作成日時 | created_at | TIMESTAMP | NOT NULL | 作成日時 |

## 3. データモデルの整合性確認

### 3.1 正規化レベル
- 第3正規形（3NF）を基本とし、パフォーマンスが必要な分析系テーブルでは非正規化を許容
- 重複データは最小限に抑え、単一責任の原則を維持

### 3.2 外部キー制約
- 全ての外部キー参照は明示的に定義
- カスケード削除は慎重に設定（論理削除を推奨）
- 参照整合性を厳格に維持

### 3.3 インデックス設計（主要なもの）
- 主キー: 全テーブル
- 外部キー: 全外部キー項目
- 検索条件: delivery_order(order_date, status), delivery_route(plan_date, status)
- 位置検索: delivery_location(latitude, longitude), vehicle_tracking(latitude, longitude)
- 複合インデックス: route_stop(delivery_route_id, stop_sequence)

### 3.4 パーティショニング戦略
- TrackingHistory: 日付によるパーティショニング（月次）
- DeliveryEvent: 日付によるパーティショニング（月次）
- PerformanceMetrics: 日付によるパーティショニング（年次）

### 3.5 データ保持期間
- マスタデータ: 論理削除、物理削除なし
- トランザクションデータ: 3年間保持
- 位置履歴: 1年間保持（それ以降はアーカイブ）
- ログ・イベントデータ: 6ヶ月間保持

## 4. データモデル補足説明

### 4.1 ステータス遷移
**DeliveryOrder**
```
PENDING → PLANNED → ASSIGNED → COMPLETED
                              ↓
                          CANCELLED
```

**DeliveryRoute**
```
PENDING → IN_PROGRESS → COMPLETED
                       ↓
                   CANCELLED
```

**DeliveryIssue**
```
OPEN → IN_PROGRESS → RESOLVED → CLOSED
```

### 4.2 座標データの扱い
- 緯度・経度はWGS84測地系を使用
- 地図API連携時のフォーマット変換を考慮
- 空間インデックス（PostGISやMySQLのSpatial Index）の活用を検討

### 4.3 JSON項目の利用
- Driver.skill_tags: 柔軟なスキル情報管理
- 将来的な拡張性を考慮した設計

### 4.4 監査証跡
- 全テーブルにcreated_at, updated_atを設定
- 重要テーブルには作成者・更新者も記録
- 変更履歴テーブルの追加も検討（必要に応じて）
